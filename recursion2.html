<!DOCTYPE html>
<html>
    <head>
        <title>Recursion</title></script>
        <link rel="stylesheet" href="styles.css">
        </script>
        <style>
            body {
                display: flex;
                align-items: center;
                justify-content: center;
                flex-direction: column;
                margin: 0;
                padding: 0;
                background-color: #e9e9ea;
                height: 100%;
                width: 100%;
            }
            h1 {
                font-size: 60px;
                font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
                margin: 100px;
                color: #282828;
            }
            ul {margin-bottom: 30px;}
        </style>
    </head>
    

    <body>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="exampleone.html">Example One</a></li>
            <li><a href="exampletwo.html">Example Two</a></li>
            <li><a href="examplethree.html">Example Three</a></li>
            <li><a href="examplefour.html">Example Four</a></li>
            <li><a href="repetition_and_structure1.html">Example Five</a></li>
            <li><a href="repetition_and_structure2.html">Example Six</a></li>
            <li><a href="recursion1.html">Example Seven</a></li>
            <li><a href="recursion2.html">Example Eight</a></li>
          </ul>

          <h3>Recursion</h3>
          <div class="slidecontainer" style="margin-top: 30px;">
            <p>Grid Size</p>
            <input type="range" min="0" max="8" value="5" id="gridsize-input" class="slider" >
            <p>Hypnotic depth</p>
            <input type="range" min="0" max="15" value="5" id="depth-input" class="slider" >
          </div>
          
    </body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js" integrity="sha512-N4kV7GkNv7QR7RX9YF/olywyIgIwNvfEe2nZtfyj73HdjCUkAfOBDbcuJ/cTaN04JKRnw1YG1wnUyNKMsNgg3g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>


const MAX_HEIGHT = 600;
const MAX_WIDTH = 600;
const step = 30;
let finalSize = 3;
let startSteps;
let offset = 2;
//User Control 1: The divisor gridSize at the end of the below is the grid size value
// NB Variables below must use VAR so they can be updated within various functions
var gridSize = 6;
var tileStep = (MAX_HEIGHT - offset * 2) / gridSize;
var startSize = tileStep;
let directions = [-1, 0, 1];
const TONES_1 = [[238, 66, 102], [31, 64, 104], [242, 228, 181]];
const TONES_2 = [[37, 106, 220], [31, 64, 104], [169, 251, 215]];
const MONOCHROME = new Array(10).fill(0).map((_, i) => [i*24, i*25, i*26]);
var gridSizeInput = document.getElementById('gridsize-input');
var depthInput = document.getElementById('depth-input');

const RELOAD_TIMEOUT = 3000;

const BACKGROUND_COLOR = [0, 32, 63];



function setup(){
  createCanvas(MAX_HEIGHT, MAX_WIDTH);
  background(BACKGROUND_COLOR[0], BACKGROUND_COLOR[1], BACKGROUND_COLOR[2]);
  stroke(0, 32, 63);
  noLoop();
  // User Control 2: Adjust stroke weight down for higher depth values
  strokeWeight(2);
}

drawRect = (x, y, width, height, xMovement, yMovement, steps) => {
  let random_index = Math.floor(Math.random() * TONES_2.length);
  const [r, g, b] = TONES_2[random_index];
  fill(r, g, b);
  rect(x, y, width, height);
    
  if(steps >= 0) {
    let newSize = (startSize) * (steps / startSteps) + finalSize;
    // User Control 3: The Value at the end of the next 4 lines controls the recursion - position and offset of centre point
    let newX = x + (width - newSize) / 2
    let newY = y + (height - newSize) / 2
    newX = newX - ((x - newX) / (steps + 2)) * xMovement
    newY = newY - ((y - newY) / (steps + 2)) * yMovement
    drawRect(newX, newY, newSize, newSize, xMovement, yMovement, steps - 1);
  }
    
}

gridSizeInput.oninput = function() {
  console.log('Redrawing:');
  setup();
  draw();
}

depthInput.oninput = function() {
  console.log('Redrawing:');
  setup();
  draw();
}

function draw(){  
  gridSize = gridSizeInput.value;
  tileStep = (MAX_HEIGHT - offset * 2) / gridSize;
  startSize = tileStep;
  console.log('MAX_HEIGHT', MAX_HEIGHT);
  console.log('offset', offset);
  console.log('tileStep', tileStep);
  console.log('gridSize thing3', gridSize);
  console.log('startSize', startSize);
  depth = depthInput.value;
  for( let x = offset; x < MAX_WIDTH - offset; x += tileStep) {
    for( var y = offset; y < MAX_HEIGHT - offset; y += tileStep) {
      // User Control 4: The value 2 before the Maths.ceil function below controls the min and max number of smaller squares within each square on the grid. Try changing between 1 and 10.
      startSteps = 3 + Math.ceil(Math.random() * depth);
      let xDirection = directions[Math.floor(Math.random() * directions.length)]
      let yDirection = directions[Math.floor(Math.random() * directions.length)]
      drawRect(x, y, startSize, startSize, xDirection, yDirection, startSteps - 1);
    }
  }
}

function redraw(){
  console.log('updated');
//let gridSize = gridSizeInput.value;
//let tileStep = (MAX_HEIGHT - offset * 2) / gridSize;

draw();
}

    </script>
</html>